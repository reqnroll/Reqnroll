<Project>
  <!--
  REQNROLL GENERATOR PLUGIN SDK
  
  This file defines properties and extensions to MSBuild which ensure a generator plugin is built and packed correctly.
  
  The generator is loaded into the MSBuild runtime during project builds. Extensions to the generator are delivered as
  MSBUild-extension packages, independant from the runtime assemblies. The plugin assembly is packaged into the /build
  path, including all any dependencies that are not provided by the generator or the MSBuild runtime.
  
  NuGet package layout:
  /assets
    /icon.png <- The package icon
  /build      <- Contains a copy of all files from the project's /build folder
    /<tfm>    <- Contains the plugin assembly compiled for that Target Framework plus redestributable dependencies
  -->
  
  <PropertyGroup>
    <!-- Assemble output in the build path -->
    <BuildOutputTargetFolder>build</BuildOutputTargetFolder>

    <!-- This is required to ensure dependencies are made available for packing -->
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>

    <!-- Assembly signing -->
    <AssemblyOriginatorKeyFile>$(ReqnrollKeyFile)</AssemblyOriginatorKeyFile>
    <SignAssembly>$(ReqnrollEnableStrongNameSigning)</SignAssembly>
    <PublicSign>$(ReqnrollPublicSign)</PublicSign>
  </PropertyGroup>

  <!-- All generator plugins must reference the generator. This also doubles as a version-compatibility declaration in the package. -->
  <ItemGroup>
    <ProjectReference Include="$(MSBuildThisFileDirectory)../Reqnroll.Generator/Reqnroll.Generator.csproj"/>
  </ItemGroup>
  
  <!-- Build assets are included in the package. -->
  <ItemGroup>
    <None Include="build/**" Pack="true" PackagePath="build" />
    <UpToDateCheckInput Include="build/**" />
  </ItemGroup>

  <!-- Mark all package as private so they don't get declared in the NuGet depdendencies. -->
  <ItemGroup>
    <PackageReference Update="@(PackageReference)">
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
  </ItemGroup>
</Project>