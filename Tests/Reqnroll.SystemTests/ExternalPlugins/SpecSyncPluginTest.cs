using Microsoft.VisualStudio.TestTools.UnitTesting;
using Reqnroll.TestProjectGenerator.Driver;
using Reqnroll.TestProjectGenerator;

namespace Reqnroll.SystemTests.ExternalPlugins;

[TestClass]
//TODO: remove Ignore attribute once incompatibility is resolved
[Ignore("The SpecSync.AzureDevOps.TestSuiteBasedExecution.Reqnroll plugin is not compatible with the Cucumber Messages generator changes")]
public class SpecSyncPluginTest : ExternalPluginsTestBase
{
    protected override void TestInitialize()
    {
        base.TestInitialize();
        _testRunConfiguration.UnitTestProvider = UnitTestProvider.MSTest;
        _projectsDriver.AddNuGetPackage("SpecSync.AzureDevOps.TestSuiteBasedExecution.Reqnroll", "3.4.23");
    }

    [TestMethod]
    //TODO: remove Ignore attribute once incompatibility is resolved
    [Ignore("The SpecSync.AzureDevOps.TestSuiteBasedExecution.Reqnroll plugin is not compatible with Gherkin v32")]
    public void SpecSync_should_work_with_Reqnroll()
    {
        AddFeatureFileFromResource("SpecSyncPlugin/SpecSyncTestFeature.feature", resourceGroup: "ExternalPlugins");
        AddContentFileFromResource("SpecSyncPlugin/specsync.json", resourceGroup: "ExternalPlugins");
        AddPassingStepBinding();

        ExecuteTests();

        ShouldAllScenariosPass(_preparedTests + 1); // one extra test generated by the plugin
    }

    [TestMethod]
    [TestCategory("MsBuild")]
    //TODO: remove Ignore attribute once incompatibility is resolved
    [Ignore("The SpecSync.AzureDevOps.TestSuiteBasedExecution.Reqnroll plugin is not compatible with Gherkin v32")]
    public void SpecSync_should_work_with_Reqnroll_on_DotNetFramework_generation()
    {
        // compiling with MsBuild forces the generation to run with .NET Framework
        _compilationDriver.SetBuildTool(BuildTool.MSBuild);
        SpecSync_should_work_with_Reqnroll();
    }

}